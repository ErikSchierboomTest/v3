name: "Verify Markdown formatting"

on:
  push:
    paths:
      - "**.md"
  pull_request:
    paths:
      - "**.md"

jobs:
  stylecheck:
    runs-on: [ubuntu-latest]
    steps:
      - name: "Checkout code"
        uses: actions/checkout@v2

      - name: "Verify Markdown formatting"
        run: |
          PULL_REQUEST_URL=$(jq -r ".pull_request.url" "$GITHUB_EVENT_PATH")

          if [ "$PULL_REQUEST_URL" == "null" ]; then
            echo "Checking the formatting of all Markdown files in this repository"
            npx prettier@2.0.4 --check "**/*.md"
          else
            echo "Checking the formatting of all added or modified Markdown files in this PR"
            curl --url $"${PULL_REQUEST_URL}/files" --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
              jq -c '.[] | select(.status == "added" or .status == "modified") | select(.filename | match(".md$")) | .filename' | \
              xargs npx prettier --write
          fi
